var CONFIG={URL_ERROR:"/error",CGI_LOADWORK:"/api/w/",blankImageUrl:"/img/edit/blank.png",defaultText:'<p style="line-height:1.5;"><span style="font-family: 微软雅黑, \'Microsoft YaHei\'; font-size: 30px;">编辑文本</span></p>',emptyText:'<p style="line-height:1.5;"><span style="font-family: 微软雅黑, \'Microsoft YaHei\'; font-size: 30px;"></span></p>',textCustomStyle:{root:'margin:0;word-break:break-all;line-height:normal;font-size:14px;			color:#000;font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;',p:"margin:0 0 10px;",a:"color:#08C;text-decoration:none;","a:hover":"color:#005580;text-decoration:underline;","ol,ul":"padding:0!important;margin:0 0 10px 25px!important;width:auto!important;",li:"line-height:normal;",hr:"margin:20px 0;border:0;border-top:1px solid #EEE;border-bottom:1px solid #FFF;",img:"vertical-align:middle;border:0","h1,h2,h3,h4,h5,h6":"line-height:inherit;margin:10px 0;",h1:"font-size:38.5px;",h2:"font-size:31.5px;",h3:"font-size:24.5px;",h4:"font-size:17.5px;",h5:"font-size:14px;",h6:"font-size:11.9px;",blockquote:"padding:0 0 0 15px;margin:0 0 20px;border-left:5px solid #eee","blockquote p":"line-height:inherit;font-size:16px;",table:"margin-bottom:10px;border-collapse:collapse;display:table;","tr td,tr th":"padding:5px;border:1px solid #DDD;background:none","td p":"margin:0;padding:0;"},transitionEndEvent:"undefined"!=typeof window.ontransitionend?"transitionend":"undefined"!=typeof window.onwebkittransitionend?"webkitTransitionEnd":"notSupport"};Jx().$package("press.util",function(e){var t=e.dom,a=(e.event,this);window.UTIL=a={resetTextStyle:function(){var e=[],a=CONFIG.textCustomStyle;for(var n in a)e.push(".elem_text "+("root"===n?"":n.split(",").join(",.elem_text "))+"{"+a[n]+"}");t.createStyleNode(e.join("\n"))}}}),window.press=window.press||{},function(){press.shape={},press.shape.DEFAULT_WIDTH=300,press.shape.DEFAULT_HEIGHT=100,press.shape.DEFAULT_ICON_WIDTH=100,press.shape.DEFAULT_ICON_HEIGHT=100,press.shape.DEFAULT_THUMB_WIDTH=40,press.shape.DEFAULT_THUMB_HEIGHT=40,press.shape.DEFAULT_FILL="rgba(0,0,0,1)",press.shape.DEFAULT_STROKE="rgba(0,0,0,0)",press.shape.DEFAULT_STROKEWIDTH="1px",press.shape.isEditMode=!1}(),function(){press.shape.tools={};var e=press.shape.tools;e.pathList={},e.cpList={},e.fit=function(t,a){for(var n=e.getSvgContainer(t),r=n.querySelector("path"),s=n.querySelectorAll("._plugin_cp"),o=r.getAttribute("pathId"),i=r.pathSegList,l=e.pathList[o],c=0;c<i.numberOfItems&&l[c];c++){var p=i.getItem(c),d=l[c].x,u=l[c].y;p.x=a.w*d/press.shape.DEFAULT_THUMB_WIDTH,p.y=a.h*u/press.shape.DEFAULT_THUMB_HEIGHT}for(var c=0;c<s.length;c++){var f=s[c],h=f.getAttribute("id"),d=e.translate(f).x,u=e.translate(f).y,m=e.cpList[h];if(void 0!==m.bindPoint){var v=i.getItem(m.bindPoint).x,g=i.getItem(m.bindPoint).y;e.translate(f,v,g,!0)}}},e.getSvgContainer=function(e){for(var t=0;e&&"svg"!==e.tagName&&t++<20;)e=e.parentNode;return e},e.scaleSvgEl=function(e,t,a){a=a||t;var n=e.getAttribute("transform"),r=n.match(/scale\(([^ ]+)([^,]*)\)/);r?(n=n.replace(/scale\(([^ ]+)([^,]*)\)/,"scale("+t+","+a+")"),e.setAttribute("transform",n)):e.setAttribute("transform","scale("+t+","+a+")")},e.getSvgScale=function(e){var t=e.getAttribute("transform")||0,a=t.match(/scale\(([^ ]+)([^,]*)\)/)||[],n=a[1]||1,r=a[2]||1;return{scaleX:n,scaleY:r}},e.translate=function(e,t,a,n){var r=(e.tagName,e.getAttribute("transform")||"");if(param=r.match(/translate\(([^,]+),([^,)]+)\)/),!t&&!a)return{x:param&&parseFloat(param[1]),y:param&&parseFloat(param[2])};if(param){var s=n?t:t+parseInt(param[1]),o=n?a:a+parseInt(param[2]);r=r.replace(/translate\(([^,]+),([^,)]+)\)/,"translate("+s+","+o+")"),e.setAttribute("transform",r)}else e.setAttribute("transform","translate("+t+","+a+") "+r)},e.parsePath=function(t,a){var n=t.tagName;if("path"==n){var r=t.pathSegList,s=+new Date;if(t.setAttribute("pathId",s),a)e.pathList[s]=a;else{e.pathList[s]={};for(var o={},i=0;i<r.numberOfItems;i++)o[i]={x:r.getItem(i).x,y:r.getItem(i).y};e.pathList[s]=o}return r}},e.buildSvgShapeEl=function(t){if(!document.createElementNS){var a=document.createElement("p");return a.innerHTML=">_< <br />形状现在不能工作",a.style.width=t.width+"px",a.style.height=t.height+"px",a.style.background="#BC6320",a.style["text-align"]="center",a}var a=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=t.shape,r=1.2;t.width=n.style&&n.style.width||t.width,t.height=n.style&&n.style.height||t.height,a.setAttribute("width",t.width),a.setAttribute("height",t.height),a.setAttribute("version",1.1),a.setAttribute("type",n.type),a.setAttribute("stroke",press.shape.DEFAULT_STROKE),a.setAttribute("stroke-width",press.shape.DEFAULT_STROKEWIDTH),a.setAttribute("fill",press.shape.DEFAULT_FILL),t.fill&&a.setAttribute("fill",t.fill),t.stroke&&a.setAttribute("stroke",t.stroke),t["stroke-width"]&&a.setAttribute("stroke-width",t["stroke-width"]);var s=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","path");if(o.setAttribute("d",n.svgData),s.appendChild(o),s.setAttribute("transform","scale(1,1)"),a.appendChild(s),press.shape.isEditMode&&n.controls&&e.parseControls(a,n.controls),n.style&&(n.style.width&&a.setAttribute("width",n.style.width),n.style.height&&a.setAttribute("height",n.style.height),n.style.stroke&&a.setAttribute("stroke",n.style.stroke),n.style.fill&&a.setAttribute("fill",n.style.fill),n.style["stroke-width"]&&a.setAttribute("stroke-width",n.style["stroke-width"])),"svg_icon"==n.type){var i=t.width*r/press.shape.DEFAULT_THUMB_WIDTH,l=t.height*r/press.shape.DEFAULT_THUMB_HEIGHT;s.setAttribute("transform","scale("+i+","+l+")")}else e.parsePath(o,n.segData),e.fit(a,{w:t.width,h:t.height});return a}}(),Jx().$package("press.loading",function(e){var t=e.http,a=e.dom,n=e.event,r=e.json,s=this;window.activeStep=0;var o,i={frameWidth:1440,frameHeight:900,version:"1.0"},l={frames:{},global:{}},c={},p=!1,d=0,u=a.mini(".bar")[0],f=function(e,t){l.frames[e]||(l.frames[e]=[]),l.frames[e].push(t),press.isEditPage&&"image"===t.type&&h(e),a.addClass(t.node,"source_loading")},h=function(e){c[e].count++},m=function(e){var t=c[e];t.loaded++,t.loaded==t.count&&(press.previewPanel.updateCanvas(e),delete c[e])},v=function(e){var t,n,r,s,o,i=l.frames;for(t=0,s=e.length;s>t;t++)if(r=i[e[t]]){for(n=0,o=r.length;o>n;n++)!function(e,t){var n=e.node;n.onload=function(){a.removeClass(n,"source_loading"),press.isEditPage&&"image"===e.type&&m(t)},n.src=e.src}(r[n],e[t]);delete i[e[t]]}},g=function(e,t){var a,n=l.frames[e];if(n)for(var r=n.length;r--;)if(n[r].node.id===t){a=n[r];break}return a},y=function(t,a,n){for(var r=l.frames[t],s=r.length;s--;)if(r[s].node.id===a){e.extend(r[s],n);break}},b=function(e){p=Boolean(e)},w=function(e){var t=r.parse(e.responseText);switch(t.retcode){case 0:k(t.result);break;case 100001:window.location.href=CONFIG.URL_ERROR}},x=function(){window.location.href=CONFIG.URL_ERROR},k=function(e){C(3);var t=s.workdata=e;s.isPublic=e.isPublic?1:0,t.doc||(s.isNew=1,t.doc={frame:{},global:{},step:[]}),t.doc.counter||(t.doc.counter=0),t.doc.setting||(t.doc.setting=i),s.doc=t.doc,s.steps=t.doc.step,M(),p&&(press.main.init(),C(1))},M=function(){var e,t=s.steps,a=s.doc.frame;for(var n in a){e=!1;for(var r=t.length;r--;)t[r]!==n||(e=!0);e||delete a[n]}},C=function(e){d+=e,a.setStyle(u,"width",d/o*100+"%"),d>=o&&setTimeout(function(){a.removeClass(document.body,"loading")},200)},A=function(){var r=press.isEditPage=/\/edit$/.test(location.href);if(r){if("webkit"!==e.browser.engine.name)return void a.addClass(document.body,"notSupport");n.addObserver(press,"ready",function(){t.loadScript("http://tajs.qq.com/stats?sId=24711134"),t.loadScript("http://www.ipresst.com/js/common/report.js")});var i=/w\/([^\/]*)\/edit/.exec(location.href),l=s.workId=i&&i[1]?i[1]:"";l?(o=10,t.ajax(CONFIG.CGI_LOADWORK+l,{method:"GET",accept:"application/json",onSuccess:w,onError:x})):window.location.href=CONFIG.URL_ERROR}else{var c=/mode=(\w+)/.exec(location.search);press.playMode=c&&c[1]?c[1]:"magic","server"!==press.playMode&&n.addObserver(press,"ready",function(){t.loadScript("http://tajs.qq.com/stats?sId=24711134"),t.loadScript((window.isExport?"":"/")+"js/common/report.js")}),window.isExport?press.isExport=!0:-1!==location.search.indexOf("preview=")&&window.opener!==window?(window.workdata=e.extend({},window.opener.press.loading.workdata),press.isPreview=!0):"backend.ipresst.com"===location.host&&(press.isBackend=!0),window.workdata?k(window.workdata):press.isExport?alert("抱歉，导出的作品有问题，无法播放"):window.location.href=CONFIG.URL_ERROR}},S=function(){var e,t=function(){var e=/step=(\d+)/.exec(location.hash);return e&&e[1]?(e=parseInt(e[1])-1,e>=s.steps.length&&(e=0)):e=0,e};return n.addObserver(press,"ready",function(){press.play&&n.addObserver(press.play,"frameChanged",function(t){e="#step="+(t+1),e!==location.hash&&(location.hash=e)}),n.addObserver(s,"hashchange",function(){if(e!==window.location.hash){var a=t();press.workSpace?press.workSpace.moveToFrame(a):press.play.moveTo(a)}})}),n.on(window,"hashchange",function(){n.notifyObservers(s,"hashchange")}),{getIndexFromHash:t}}();e.extend(this,{setAllLoaded:b,updateProgress:C,addSource:f,loadSource:v,checkSource:g,updateSource:y,getIndexFromHash:S.getIndexFromHash}),this.source=l,this.imgSource=c,A()}),Jx().$package("press.map",function(e){var t=e.dom,a=e.event,n=e.http,r={},s=[],o=[],i=function(e){var t={soso:"http://api.map.soso.com/v1.0/main.js?callback=loadMap"};n.loadScript(t[e],{onSuccess:function(){r[e]=!0}}),press.workSpace&&a.addObserver(press.workSpace,"updateInfo",p)},l=function(e,t){apiType=t&&t.apiType?t.apiType:"soso",r[apiType]?c(e,t):(o.push({id:e,conf:t}),i(apiType))},c=window.loadMap=function(e,n){if(!e){for(var r=0,i=o.length;i>r;r++)c(o[r].id,o[r].conf);return void(o=[])}var l=n&&n.apiType?n.apiType:"soso",p="soso"==l?soso:google,d=t.id(e),u=new p.maps.LatLng(39.907333,116.391083),f={zoom:8,center:u,mapTypeId:p.maps.MapTypeId.ROADMAP},h=new p.maps.Map(d,f),m=new p.maps.Marker({map:h,position:u,draggable:!0});if(n){var v=new p.maps.LatLng(n.cLat,n.cLng),g=new p.maps.LatLng(n.pLat,n.pLng);h.setCenter(v),m.setPosition(g),"soso"==l?h.setZoomLevel(n.zoom):h.setZoom(n.zoom)}a.on(d,"mousewheel",function(e){e.stopPropagation()}),a.on(d,"mousedown",function(e){e.stopPropagation()}),s.push({map:h,marker:m,id:d.parentNode.id,apiType:l})},p=function(){for(var e,a,n,r,o,i,l,c,p=s.length;p--;)l=s[p],o=l.id,t.id(o)?(i=l.apiType,e=l.map,a=l.marker,n=e.getCenter(),r=a.getPosition(),c={type:e.getMapTypeId(),cLat:"soso"==i?n.getLat():n.lat(),cLng:"soso"==i?n.getLng():n.lng(),zoom:"soso"==i?e.getZoomLevel():e.zoom,pLat:"soso"==i?r.getLat():r.lat(),pLng:"soso"==i?r.getLng():r.lng(),apiType:i},press.workSpace.saveElemInfo(o,{property:{config:c}})):s.splice(p,1)};e.extend(this,{add:l})}),Jx().$package("press.nfx",function(){function e(e,t){var a={};for(var n in e)switch(n){case"scale":a[n]=t[n]/e[n];break;default:a[n]=t[n]-e[n]}return a}function t(e,t,a,n){var r,s=0;for(var o in t){switch(o){case"scale":r=Math.log(e[o])/Math.log(t[o]);break;case"translateX":case"translateY":r=Math.abs(e[o])/(t[o]/a.scale+t[o]/n.scale)*2;break;default:r=Math.abs(e[o])/t[o]}s=s>r?s:r}return 1e3*s}var a=(function(){var e=document.createElement("dummy").style,t="Webkit Moz O ms Khtml".split(" "),a={};return function(n){if("undefined"==typeof a[n]){var r=n.charAt(0).toUpperCase()+n.substr(1),s=(n+" "+t.join(r+" ")+r).split(" ");a[n]=null;for(var o in s)if(void 0!==e[s[o]]){a[n]=s[o];break}}return a[n]}}(),function(e,t){var a,n,r=e.length,s=[];for(a=0;r>a;a++)s[a]=[e[a][0],e[a][1]];for(n=1;r>n;n++)for(a=0;r-n>a;++a)s[a][0]=(1-t)*s[a][0]+t*s[parseInt(a+1,10)][0],s[a][1]=(1-t)*s[a][1]+t*s[parseInt(a+1,10)][1];return s[0][1]}),n={easeOut:function(e){return Math.sin(e*Math.PI/2)},easeOutStrong:function(e){return 1==e?1:1-Math.pow(2,-10*e)},easeIn:function(e){return e*e},easeInStrong:function(e){return 0==e?0:Math.pow(2,10*(e-1))},easeOutBounce:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},bounce:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bouncePast:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?2-(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},swingTo:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},swingFrom:function(e){var t=1.70158;return e*e*((t+1)*e-t)},elastic:function(e){return-1*Math.pow(4,-8*e)*Math.sin(2*(6*e-1)*Math.PI/2)+1},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)},blink:function(e,t){return Math.round(e*(t||5))%2},pulse:function(e,t){return-Math.cos(e*((t||5)-.5)*2*Math.PI)/2+.5},wobble:function(e){return-Math.cos(e*Math.PI*9*e)/2+.5},sinusoidal:function(e){return-Math.cos(e*Math.PI)/2+.5},flicker:function(e){var e=e+(Math.random()-.5)/5;return n.sinusoidal(0>e?0:e>1?1:e)},mirror:function(e){return n.sinusoidal(.5>e?2*e:1-2*(e-.5))}},r=requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},s=function(s){var o=(s.frameRate,s.change),i=s.ease,l=s.from,c=s.to,p=s.speed,d=s.duration,u=s.complete,f=s.callback,h=s.error;if("bezier"==i)var m=s.points;var v,g,y=+new Date;v=e(l,c),d=d||t(v,p,l,c);var b=function(){if(g){var e=+new Date,t=e-y;if(t>d&&(t=d),"bezier"==i){var s={};for(var l in m)s[l]=a(m[l],t/d);s.linear=t/d,o(s,v)}else o(n[i](t/d),v);t==d?(u&&u(),f&&f()):r(b)}};return d>0?(r(b),g=!0):h&&h("duration must be bigger than 0"),{stop:function(){g=!1}}},o=function(){var e=[],t=!1,a=null,n=function(a,n){a.callback=function(){r()},n&&o(),e.push(a),t||(r(),t=!0)},r=function(){e.length>0?a=s(e.shift()):(t=!1,a=null)},o=function(){t&&(a.stop(),t=!1,e=[])};return{add:n,stop:o}};this.animation=s,this.createAniQueue=o,this.calDur=t,this.calDiff=e}),Jx().$package("press.play",function(e){var t,a,n,r,s,o,i,l=e.dom,c=e.event,p=e.array,d=e.http,u=e.browser,f=e.cookie,h=press.loading,m=this,v=function(){var e=document.createElement("div").style,t="Webkit Moz O ms Khtml".split(" "),a={};return function(n){if("undefined"==typeof a[n]){var r=n.charAt(0).toUpperCase()+n.substr(1),s=(n+" "+t.join(r+" ")+r).split(" ");a[n]=null;for(var o in s)if(void 0!==e[s[o]]){a[n]=s[o];break}}return a[n]}}(),g=function(e,t){var a,n;for(a in t)t.hasOwnProperty(a)&&(n=v(a),null!==n&&(e.style[n]=t[a]));return e},y=function(e){return" translate("+e.x+"px,"+e.y+"px) "},b=function(e){return" rotate("+e.toFixed(6)+"deg)"},w=function(e){return" scale("+e.toFixed(6)+") "},x=function(e,t){var a=e[0],n=e[1];t=t/180*Math.PI;var r=a*Math.cos(t)+n*Math.sin(t),s=n*Math.cos(t)-a*Math.sin(t);return[r,s]},k=function(e){var t=6,a={};for(var n in e)a[n]=Number(e[n].toFixed(t));return a},M=!(u.ie&&Number(u.ie)<9),C=function(e){if(M)return e;var t=/rgba\((.*)\)/.exec(e);if(!t||!t[1])return e;var a=t[0];t=t[1].split(",");var n="#"+(1<<24|parseInt(t[0])<<16|parseInt(t[1])<<8|parseInt(t[2])).toString(16).substr(1);return e.replace(a,n)},A=function(){var e,t="";return function(a){t+="\n"+a,e||(e=setTimeout(function(){l.createStyleNode(t),t="",e=null},300))}}(),S=document.body,T=0,I={},E={},_=null,O=l.id("workSpace"),P=l.id("background"),L=l.id("wrapper"),D=l.id("view_toPrev"),F=l.id("view_toNext"),X=["border","background","padding","border-radius","opacity","drop-shadow","transition"],Y=new e.ui.MaskLayer({opacity:0});Y.setZIndex(9e6);var N,R={maxScale:10,minScale:0,bgRate:.8};R.bgRate2=R.bgRate/(1-R.bgRate);var z,H,B,U,j=e.platform.touchDevice,q=function(){var e=o/r.frameHeight,t=s/r.frameWidth,a=e>t?t:e;return R.maxScale&&a>R.maxScale&&(a=R.maxScale),R.minScale&&a<R.minScale&&(a=R.minScale),i=a,a},W=l.id("logo"),G=l.id("logoImg"),$=function(){var e=18,t=11;e+=(s-r.frameWidth*i)/2,t+=(o-r.frameHeight*i)/2,W.style.left=e+"px",W.style.top=t+"px"},V=function(e){var t=a.frame[e].property,n=l.node("div",{id:e+"_b","class":"frame-box",style:"width:"+t.width+"px;height:"+t.height+"px"});return l.id(e).appendChild(n),n},J=function(e,t){var a,n="",r="";if("frame"===t.type){var s,o=["backgroundColor","backgroundImage"];r="#"+e.id+"_b";for(var i=0,l=o.length;l>i;i++)a=t[o[i]],a&&(s||(s=V(e.id)),"backgroundImage"===o[i]&&"url"!==a.slice(0,3)&&(a="url("+a+")"),o[i]=o[i].replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),n+=o[i]+":"+a+";")}else{r="#"+e.id;for(var c,i=X.length;i--;)a=t[X[i]],a&&(a=C(a),"drop-shadow"===X[i]?n+="-webkit-filter:drop-shadow("+a+");":(c=X[i].replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),n+=c+":"+a+";"))}n&&(n=r+" {"+n+"}"),t.hoverStyle&&(n+=r+":hover {"+t.hoverStyle+"}"),A(n)},K=function(e){document.body.style.backgroundColor=e},Z=function(e){if(e.src){var t=l.node("img",{"class":"elem elem_background"+e.type=="3D"?"3D":"",src:e.src,id:e.id});g(t,{width:e.width+"px",height:e.height+"px",transform:"translate(-50%, -50%)"+y({x:e.translateX,y:e.translateY})+b(e.rotate)+w(e.scale)}),P.appendChild(t),Q(),z="background3D"===e.type}},Q=function(e){e=e||I;var t=R.bgRate2/(e.scale+R.bgRate2);g(P,{transform:"rotate("+e.rotate+"deg)scale("+e.scale*R.bgRate+")translate("+e.translateX*t+"px,"+e.translateY*t+"px)"})},et=function(e){var t=l.node("audio",{src:e.src,autoplay:"autoplay",loop:"loop",controls:"controls",id:"bgSound"});S.appendChild(t),press.control.enableBgSound()},tt=function(e){if("frame"===e.type)return{width:0,height:0};var t=e.padding?parseInt(e.padding)||0:0,a=e.border&&-1===e.border.indexOf(" none ")?parseInt(e.border)||0:0;return{width:e.width+2*(t+a),height:e.height+2*(t+a)}},at=function(){N||(N=new e.ui.Fps),H?(H=!1,l.addClass(N.domPanel,"none")):(H=!0,l.removeClass(N.domPanel,"none"))},nt=function(){var e=press.loading.workdata,t=press.control;window.jiathis_config={siteNum:5,url:location.href.replace(/#.*/,""),sm:"cqq,tqq,tsina,qzone,copy",summary:e.desc,title:"#iPresst#【"+e.title+"】",boldNum:0,appkey:{tsina:"3690433065",tqq:"801198560"},hideMore:!0,onShow:function(e,a){"view_share"===e.id?(t.setFixed(!0),a.style.margin="0 0 0 -88px"):"view_share_b"===e.id&&(a.style.margin="0 0 0 1px")},onHide:function(e){parseInt(e.style.top)<100&&!t.alwaysFixed&&t.setFixed(!1)}},d.loadScript((press.isExport?"":"/")+"js/common/jia.min.js",{onSuccess:function(){var e=l.id("view_share"),t=l.id("view_share_b");l.removeClass(e,"disabled"),l.removeClass(t,"disabled"),e.title="分享"}})},rt=function(){if(T!==n.length-1){var e=h.source.frames,t=n[T+1];e[t]&&h.loadSource([t])}},st={},ot=function(e,t){st[e.name]=t,st[e.name].info=e,st[e.name].isSupported=e.isSupported};ot({name:"base",isSupported:!0},function(){return{hasLogo:!1,loadDynamicly:!0,hasControlCenter:!0,hasProgress:!0,hasAutoPlay:!0,hasViewEndBox:!0,useAnimation:!0,init:function(){},onresize:function(){},bindEvents:function(){},setElPos:function(){},gridAnimation:function(){},calTargetStyle:function(){},inView:function(){}}}),ot({name:"normal",label:"经典模式",inMenu:!0,isSupported:!0},function(){var t=120,c=u.ie,p="8.0"===u.ie,d={translateX:800,translateY:800},f=function(){for(var s=a.frame,o=t+r.frameWidth,i=0,l=n.length;l>i;i++)e.extend(s[n[i]].property,{translateX:i*o,translateY:0})},h=function(){f();var t=a.frame[n[T]].property;I=p||!c?{translateX:-t.translateX+s/2/i,translateY:-t.translateY+o/2/i}:{translateX:-t.translateX*i+s/2,translateY:-t.translateY*i+o/2},e.extend(E,I),O.style.cssText+=";zoom:"+i+";left:"+I.translateX+"px;top:"+I.translateY+"px;"},m=function(){if(p||!c){var e,t=a.frame;for(var n in t){v(l.id(n),t[n].property),e=t[n].children;for(var r in e)v(l.id(r),e[r].property)}}O.style.zoom=i,mt(T)},v=function(e,t){var a,n,r=t.width,s=t.height,o=tt(t);a=o.width,n=o.height,"frame"===t.type&&(r=0,s=0),e.style.cssText+=p?";width:"+r+"px;height:"+s+"px;left:"+Math.round((t.translateX-a/2)*i)+"px;top:"+Math.round((t.translateY-n/2)*i)+"px;":";width:"+r+"px;height:"+s+"px;left:"+Math.round(t.translateX-a/2)+"px;top:"+Math.round(t.translateY-n/2)+"px;"},g=function(t){if(t||(t={}),t.noAnimation){I.translateX=E.translateX,I.translateY=E.translateY;var a=k(I);return O.style.cssText+=";left:"+a.translateX+"px;top:"+a.translateY+"px;",yt(),void(t.onComplete&&t.onComplete())}var n=e.extend({},I);_.add({frameRate:60,change:function(e,t){I.translateX=n.translateX+e.translate*t.translateX,I.translateY=n.translateY+e.translate*t.translateY;var a=k(I);O.style.cssText+=";left:"+a.translateX+"px;top:"+a.translateY+"px;",yt(),H&&N.log()},ease:"bezier",points:{translate:[[0,0],[.26,.86],[.44,.98],[1,1]]},duration:800,from:n,to:E,speed:d,complete:function(){t.onComplete&&t.onComplete(),H&&N.pause()},error:t.onComplete},!0)},y=function(e,t,n){var r;"frame"===n&&(r=a.frame[t].property,E=p||!c?{translateX:-r.translateX+s/2/i,translateY:-r.translateY+o/2/i}:{translateX:-(r.translateX*i)+s/2,translateY:-(r.translateY*i)+o/2})},b=function(e){{var t=a.frame[e].property,n=r.frameWidth/2,o=(r.frameHeight/2,s/2);I.scale}return p||!c?Math.abs(I.translateX+t.translateX-s/2/i)*i<o+n*i:Math.abs(I.translateX+t.translateX*i-s/2)<o+n*i};return e.extend(lt("base"),{hasControlCenter:!1,init:h,onresize:m,setElPos:v,gridAnimation:g,calTargetStyle:y,inView:b})}),ot({name:"magic",label:"镜头模式",inMenu:!0,isSupported:v("transform")},function(){var t,p,d,f={translateX:1500,translateY:1500,rotate:90},h=4,m=!1,M=function(){C();var t=v("userSelect");t?S.style[t]="none":S.onselectstart=function(){return!1};var r=a.frame[n[T]].property;I={translateX:-r.translateX,translateY:-r.translateY,rotate:-r.rotate,scale:1/r.scale*i},e.extend(E,I),g(O,{transform:"rotate("+I.rotate+"deg)scale("+I.scale+")translate("+I.translateX+"px,"+I.translateY+"px)"})},C=function(){9==Number(u.ie)?(t=yt,p=yt,d=""):(t=function(){F(yt())},p=function(){X(yt())},d="translateZ(0)")},A=function(e){E.scale=E.scale/e*i,U()},P=function(){var t,a,n,r,i=function(n,r){_.stop();var s=I.rotate,o=I.scale,i=x([t,a],s),l=x([n,r],s),c=i[0],p=i[1],d=l[0],u=l[1],f=d-c,h=u-p;I.translateX+=f/o,I.translateY+=h/o,t=n,a=r,e.extend(E,I),yt(),g(O,{transform:"rotate("+I.rotate+"deg) scale("+I.scale+") translate("+I.translateX+"px,"+I.translateY+"px)"}),z&&Q()},l=function(e,t,a){var n=E.rotate,r=x([e.x-s/2,e.y-o/2],n),i=r[0],l=r[1];t&&(E.translateX-=i*(t/E.scale-1)/t,E.translateY-=l*(t/E.scale-1)/t,E.scale=t),a&&(a%=360,a>180?a-=360:-180>a&&(a+=360),E.rotate=a),U({noAnimation:j,isMouseEvent:!0,mousePosX:i,mousePosY:l,speedScale:50})};if(j)c.addObserver(press.play,"touchStart",function(e,s){t=s[0].x,a=s[0].y,n=I.scale,r=I.rotate}),c.addObserver(press.play,"touchDrag",function(e,t){i(t[0].x,t[0].y)}),c.addObserver(press.play,"touchScale",function(e,t){l(t.center,n*t.scale)}),c.addObserver(press.play,"touchRotate",function(e,t){l(t.center,null,r+t.rotate)});else{var d=!1;c.on(L,"drag",function(e){d=!0,t=e.pageX,a=e.pageY,Y.show()}),c.on(document,"mousemove",function(e){d&&(B=null,i(e.pageX,e.pageY))}),c.on(document,"mouseup",function(){d=!1,Y.hide()});var u;c.on(L,"mousewheel",function(e){"IFRAME"!=e.target.tagName&&(u&&clearTimeout(u),u=setTimeout(function(){_.stop(),p(),E={scale:I.scale,rotate:I.rotate,translateX:I.translateX,translateY:I.translateY}},300),B=null,l({x:e.pageX,y:e.pageY},e.wheelDelta>0?1.5*E.scale:E.scale/1.5))})}},D=function(e,t,a){var n=t.width;height=t.height,offsetSize=tt(t),"frame"==t.type&&(n=0,height=0),g(e,{width:n+"px",height:height+"px",transform:y({x:Math.round(t.translateX-offsetSize.width/2),y:Math.round(t.translateY-offsetSize.height/2)})+b(t.rotate)+w(t.scale)+(a?"":d)})},F=function(e){if(!m)for(var t in e){D(l.id(t),e[t].property);var a=e[t].children;for(elId in a){var n=a[elId].property;D(l.id(elId),n)}}m=!0},X=function(e){if(m){var t=k(I);g(O,{transform:"rotate("+t.rotate+"deg)scale("+t.scale+")translate("+t.translateX+"px,"+t.translateY+"px)"});for(var a in e){D(l.id(a),e[a].property,!0);var n=e[a].children;for(elId in n){var r=n[elId].property;if("text"==r.type){{l.id(elId)}D(l.id(elId),r,!0)}}}}m=!1},R=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},U=function(a){if(a||(a={}),a.noAnimation){I.translateX=E.translateX,I.translateY=E.translateY,I.rotate=E.rotate,I.scale=E.scale;var n=k(I);return g(O,{transform:"rotate("+n.rotate+"deg)scale("+n.scale+")translate("+n.translateX+"px,"+n.translateY+"px)"+d}),z&&Q(),p(),void(a.onComplete&&a.onComplete())}Math.abs(E.rotate-I.rotate)>180&&(I.rotate<0?I.rotate+=360:I.rotate-=360);var r={x:I.translateX,y:I.translateY},i={x:E.translateX,y:E.translateY},l=R(r,i),c=Math.max(s,o),u=!0,m={},v=a.speedScale||h;if(!a.isMouseEvent&&l*I.scale>c){var y={};m.scale=c/l,m.rotate=I.rotate,m.translateX=(r.x+i.x)/2,m.translateY=(r.y+i.y)/2,f.scale=m.scale>I.scale?v:1/v;var b=press.nfx.calDur(press.nfx.calDiff(I,m),f,I,m);f.scale=E.scale>m.scale?v:1/v;var w=press.nfx.calDur(press.nfx.calDiff(m,E),f,m,E);m.rotate=I.rotate+(E.rotate-I.rotate)*b/(b+w),e.extend(y,I),_.add({frameRate:60,change:function(e,a){var n=y.scale*Math.pow(a.scale,e.scale);I.translateX=y.translateX+e.translate*a.translateX,I.translateY=y.translateY+e.translate*a.translateY,I.scale=n,I.rotate=y.rotate+e.translate*a.rotate;var r=k(I);g(O,{transform:"rotate("+r.rotate+"deg)scale("+r.scale+")translate("+r.translateX+"px,"+r.translateY+"px)"+d}),z&&Q(),t(),H&&N.log()},ease:"bezier",points:{translate:[[0,0],[.29,.04],[.83,.25],[1,1]],scale:[[0,0],[.17,.75],[.71,.96],[1,1]]},from:y,to:m,speed:f},!0),u=!1}else e.extend(m,I);f.scale=E.scale>m.scale?v:1/v,_.add({frameRate:60,change:function(e,n){var r=m.scale*Math.pow(n.scale,a.isMouseEvent?e.linear:e.scale);a.isMouseEvent?(I.translateX-=a.mousePosX*(r/I.scale-1)/r,I.translateY-=a.mousePosY*(r/I.scale-1)/r):(I.translateX=m.translateX+e.translate*n.translateX,I.translateY=m.translateY+e.translate*n.translateY),I.scale=r,I.rotate=m.rotate+e.translate*n.rotate;var s=k(I);g(O,{transform:"rotate("+s.rotate+"deg)scale("+s.scale+")translate("+s.translateX+"px,"+s.translateY+"px)"+d}),z&&Q(),t(),H&&N.log()},ease:"bezier",points:u?{translate:[[0,0],[.51,.01],[.37,.98],[1,1]],scale:[[0,0],[.51,.01],[.37,.98],[1,1]]}:{translate:[[0,0],[.17,.75],[.71,.96],[1,1]],scale:[[0,0],[.29,.04],[.83,.25],[1,1]]},from:m,to:E,speed:f,complete:function(){p(),a.onComplete&&a.onComplete(),H&&N.pause()},error:a.onComplete},u)},q=function(e,t,n){var r,s;if("frame"===n)r=a.frame[t].property,E={translateX:-r.translateX,translateY:-r.translateY,rotate:-r.rotate,scale:1/r.scale*i};else{var o=a.frame[e.parentNode.id];r=o.property,s=o.children[t].property;var l=s.translateX,c=s.translateY,p=r.rotate/180*Math.PI;E={translateX:-(r.translateX+(l*Math.cos(p)-c*Math.sin(p))*r.scale),translateY:-(r.translateY+(l*Math.sin(p)+c*Math.cos(p))*r.scale),rotate:-(r.rotate+s.rotate),scale:Math.min(r.width/s.width,r.height/s.height)/r.scale*i}}},W=function(e){var t=a.frame[e].property,n=r.frameWidth*t.scale/2,i=(r.frameHeight*t.scale/2,s/2),l=o/2,c=I.scale,p=1.4*(n>l?n:l),d=1.4*(i>l?i:l);return(Math.abs(t.translateX+I.translateX)-p)*c<=d&&(Math.abs(t.translateY+I.translateY)-p)*c<=d?!0:!1};return e.extend(lt("base"),{init:M,onresize:A,bindEvents:P,setElPos:D,gridAnimation:U,calTargetStyle:q,inView:W})}),ot({name:"blur",label:"虚化模式",inMenu:!0,isSupported:"webkit"===u.engine.name&&"string"==typeof document.documentElement.style.webkitFilter},function(){var t,a,n,r="-webkit-filter",s="ease-in-out",o=500,i=25,l=lt("magic"),p=function(){l.init(),t=T,g(L,{transition:[r,s,o/1e3+"s"].join(" "),webkitFilter:"blur(0px)"}),c.on(L,"webkitTransitionEnd",d)},d=function(){a?(a=!1,l.gridAnimation({noAnimation:!0}),L.style[r]="blur(0px)"):(t=T,n&&n(),n=null)},u=function(e){return t===T?void l.gridAnimation(e):(e||(e={}),n=e.onComplete,a=!0,void(L.style[r]="blur("+i+"px)"))};return e.extend({},l,{init:p,gridAnimation:u})}),ot({name:"flip",label:"看图模式",inMenu:!0,isSupported:v("transition")},function(){var t,r,s=lt("magic"),o=v("transition"),d=function(){for(var t=a.frame,r=0,s=n.length;s>r;r++)e.extend(t[n[r]].property,{translateX:0,translateY:0,rotate:0,scale:1,zIndex:s-r})},u=function(){for(var e,t=I.step,a=E.step,r=0;a>r;r++)r!==t&&(e=l.id(n[r]),e.style[o]="none",g(e,{opacity:0,transform:"translate(-3000px, 0px)"}));for(r=n.length-1;r>a;r--)r!==t&&(e=l.id(n[r]),e.style[o]="none",g(e,{opacity:0,transform:"translate(0, 0) scale(0.8)"}));var s=l.id(n[t]),i=l.id(n[a]);a>t?(s.style[o]="-webkit-transform .8s, opacity .8s cubic-bezier(.88,.14,.98,.61)",g(s,{opacity:0,transform:"translate(-3000px, 0px)"}),i.style[o]="-webkit-transform .5s",setTimeout(function(){g(i,{opacity:1,transform:"translate(0, 0) scale(1)"})},0)):(s.style[o]="-webkit-transform .5s, opacity .5s cubic-bezier(.88,.14,.98,.61)",g(s,{opacity:0,transform:"translate(0, 0) scale(0.8)"}),i.style[o]="-webkit-transform .5s",setTimeout(function(){g(i,{opacity:1,transform:"translate(0, 0) scale(1)"})},0))},f=function(){d(),I={translateX:0,translateY:0,rotate:0,scale:i,step:T},e.extend(E,I),g(O,{transform:"rotate(0deg)scale("+i+")translate(0px,0px)"});for(var r=a.frame,s=0,o=n.length;o>s;s++)e.extend(r[n[s]].property,{translateX:0,translateY:0,rotate:0,scale:1,zIndex:o-s});c.addObserver(press.play,"afterCreateElement",function(){t.movePage({noAnimation:!0});for(var e=l.mini(".elem_frame",O),a=e.length;a--;)c.on(e[a],"webkitTransitionEnd",h)})},h=function(e){1==e.target.style.opacity&&r&&(r&&r(),r=null,console.log("onComplete"))},m=function(){I.scale=E.scale=i,g(O,{transform:"rotate(0deg)scale("+i+")translate(0px,0px)"})},y=function(e){var t=p.indexOf(n,e);return t===E.step||t===I.step},b=function(e,t,a,n){E={translateX:0,translateY:0,rotate:0,scale:i,step:n}},w=function(a){yt(),a&&(r=a.onComplete),t.movePage(a),e.extend(I,E)};return t=e.extend(lt("base"),{movePage:u,init:f,onresize:m,inView:y,calTargetStyle:b,gridAnimation:w,setElPos:s.setElPos})}),ot({name:"fade",label:"淡入模式",inMenu:!0,isSupported:v("transition")},function(){var e=lt("flip"),t=v("transition");return e.movePage=function(){var e=I.step,a=E.step,r=l.id(n[e]),s=l.id(n[a]);r.style[t]="opacity .8s",r.style.opacity=0,s.style[t]="opacity .8s",s.style.opacity=0,setTimeout(function(){s.style.opacity=1},0)},e}),ot({name:"mobile",label:"手机模式",inMenu:!1,isSupported:v("transition")},function(){var e=lt("flip");return e}),ot({name:"server",isSupported:!0},function(){var t=function(){var t=a.frame[n[T]].property;I={translateX:-t.translateX,translateY:-t.translateY,rotate:-t.rotate,scale:1/t.scale*i},e.extend(E,I),mt(T)},r=function(e,t){var a=t.width;height=t.height,offsetSize=tt(t),"frame"==t.type&&(a=0,height=0),g(e,{width:a+"px",height:height+"px",left:Math.round(t.translateX-offsetSize.width/2)+"px",top:Math.round(t.translateY-offsetSize.height/2)+"px",transform:b(t.rotate)+w(t.scale)})},l=function(){return!0},c=function(t){t||(t={}),e.extend(I,E);var a=e.extend({},I),n=-I.rotate/180*Math.PI,r=I.scale,i=I.translateX,l=I.translateY;a.translateX=r*(i*Math.cos(n)+l*Math.sin(n)),a.translateY=r*(l*Math.cos(n)-i*Math.sin(n));var c=k(a);g(O,{left:s/2+c.translateX+"px",top:o/2+c.translateY+"px",transform:"rotate("+c.rotate+"deg) scale("+c.scale+")"}),z&&Q(),t.onComplete&&t.onComplete()};return e.extend({},lt("magic"),{hasLogo:!1,loadDynamicly:!1,hasControlCenter:!1,hasProgress:!1,hasAutoPlay:!1,hasShare:!1,useAnimation:!1,init:t,setElPos:r,inView:l,gridAnimation:c})});var it=function(){return press.playMode&&st[press.playMode]||(press.playMode="magic"),st[press.playMode].isSupported||(press.playMode="normal"),console.log(press.playMode),st[press.playMode]()},lt=function(e){return e?st[e]():st},ct=function(e){return st[e].isSupported},pt=function(){for(var e=["normal","magic","blur","flip","fade","mobile"],t=e.length;t--;)e[t]=st[e[t]];return e},dt=function(e){if(e.hasAnimation)return!0;var t,a=e.frame;for(var n in a)if(a[n].animate&&a[n].animate.animateQueue.length){t=!0;
break}return t},ut=function(){if(UTIL.resetTextStyle(),U=it(),t=h.workdata,a=t.doc,r=a.setting,n=a.step,!n||0===n.length)return!1;if(T=/step=(\d+)/.exec(location.hash),T&&T[1]?(T=parseInt(T[1])-1,T>=n.length&&(T=0)):T=0,s=l.getClientWidth(),o=l.getClientHeight(),q(),_=press.nfx.createAniQueue(),U.init(),ft(a.frame,O),ft(a.global,O),c.notifyObservers(press.play,"afterCreateElement"),r.backgroundImage&&Z(r.backgroundImage),r.backgroundSound&&et(r.backgroundSound),r.backgroundColor&&K(r.backgroundColor),r.fontList){for(var i=[],p=r.fontList.length;p--;)r.fontList[p].online&&i.push(r.fontList[p]);i.length&&(press.fontDisplay?press.fontDisplay.show(i):d.loadScript((window.isExport?"":"/")+"js/common/font_display.js",{onSuccess:function(){press.fontDisplay.show(i)}}))}yt();var u=press.fsApi=new e.ui.FullScreen;return u.isSupported&&c.addObserver(u,"toggle",function(){u.isFullScreen()?(u.cancelFullScreen(),c.notifyObservers(press.fsApi,"outFullscreen")):(u.requestFullScreen(),c.notifyObservers(press.fsApi,"inFullscreen"))}),U.hasProgress&&press.progress.init(n.length,mt).move(T),U.hasAutoPlay&&press.autoPlay.init(gt),U.hasControlCenter&&press.control.init(Y),U.hasViewEndBox&&press.viewEndBox.init(),U.useAnimation&&press.animate.isSupport()&&dt(a)?(c.addObserver(press.animate,"ready",function(e){press.play.$AnimateManager=e.AnimateManager,document.body.style.opacity=1}),press.animate.playInit()):document.body.style.opacity=1,press.isPreview||press.isBackend||!U.hasControlCenter&&!U.hasViewEndBox||nt(),j||"server"===press.playMode||press.isExport||e.cookie.get("nohint")||wt(),ht(),U.hasLogo||(W.style.display="none"),c.notifyObservers(press,"afterResize",{w:s,h:o}),l.removeClass(D,"none"),l.removeClass(F,"none"),rt(),c.addObserver(m,"frameChanged",rt),!0},ft=function(e,t){var a,n,r;for(var s in e){switch(n=e[s].property,r=n.type){case"frame":a=l.node("div",{"class":"elem elem_"+r,eltype:r,id:s}),ft(e[s].children,a);break;case"text":a=l.node("div",{"class":"elem elem_"+r+(n.isButton?" elem_button":""),eltype:r,id:s}),a.innerHTML=n.text;break;case"image":a=l.node("img",{"class":"elem elem_"+r,eltype:r,id:s});break;case"web":a=l.node("iframe",{"class":"elem elem_"+r,eltype:r,frameborder:0,id:s}),a.sandbox="";break;case"audio":case"video":a=l.node(n.type,{"class":"elem elem_"+r,eltype:r,controls:"controls",id:s});break;case"flash":a=l.node("embed",{"class":"elem elem_"+r,eltype:r,src:n.src,quality:"high",width:n.width,height:n.height,align:"middle",allowScriptAccess:"always",allowFullScreen:"true",mode:"transparent",type:"application/x-shockwave-flash",id:s});break;case"map":a=l.node("div",{"class":"elem elem_"+r,eltype:r,id:s});break;case"shape":a=press.shape.tools.buildSvgShapeEl(n.param),a.setAttribute("class","elem elem_"+r),a.setAttribute("eltype",r),a.setAttribute("id",s||"elem_"+ +new Date)}"image"!==r||n.src?U.loadDynamicly?("image"===r||"video"===r||"audio"===r||"web"===r)&&h.addSource(t.id,{node:a,src:n.src,type:r}):a.src=n.src:(a.src=CONFIG.blankImageUrl,l.addClass(a,"source_error")),n.anchorType&&"none"!==n.anchorType&&(l.addClass(a,"anchor"),a.setAttribute("anchortype",n.anchorType),a.setAttribute("anchorparam",n.anchorParam)),U.setElPos(a,n,!0),a.style.zIndex=n.zIndex,t.appendChild(a),J(a,n),"map"===r&&press.map.add(s,n.config)}},ht=function(){var e=function(e){for(var t,a,n=e.target,r=n.getAttribute("eltype");!r&&"A"!==n.tagName&&n!==L;)n=n.parentNode,r=n.getAttribute("eltype");"A"!==n.tagName&&((t=n.getAttribute("anchortype"))?(a=n.getAttribute("anchorparam"),"site"===t?a&&window.open(a):"page"===t&&(a=parseInt(a),isNaN(a)||mt(a-1))):n===L||n===B||"frame"!=r&&"text"!=r&&"image"!=r&&"shape"!=r?(mt(T),B=null):mt(n.id))};if(j){var t,a,n,r,p,d,u=20,f=10,h=.9,m=8,v=[],g=[],y=function(e){var t=e.touches;return t&&t[0]?{x:t[0].pageX,y:t[0].pageY}:{x:e.pageX,y:e.pageY}},b=function(e,t){return e&&t?Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)):0},w=function(e,t){var a=Math.atan2(t.y-e.y,t.x-e.x),n=180*a/Math.PI;return n},x=function(e){v=[],g=[];for(var n,s=0;t>s;s++)n=y(e[s]),v[s]={},g[s]={},v[s].x=g[s].x=n.x,v[s].y=g[s].y=n.y;2===t&&(a=w(v[0],v[1]),r=b(v[0],v[1])),d=""};c.on(document,"touchstart",function(e){var a=e.touches;a&&(t=a.length,x(a),c.notifyObservers(press.play,"touchStart",e,v))}),c.on(document,"touchmove",function(e){var s=e.touches;if(s){B=null,e.preventDefault(),t=s.length;for(var o=0;t>o;o++)g[o]=y(s[o]);1===t?(""===d&&b(v[0],g[0])>=f&&(d="touchDrag"),"touchDrag"===d&&c.notifyObservers(press.play,d,e,g)):2===t&&(""===d||"touchScale"===d||"touchRotate"===d)&&(n=w(g[0],g[1]),p=b(g[0],g[1]),d||(h>=p/r||h>=r/p?d="touchScale":Math.abs(n-a)>=m&&(d="touchRotate")),"touchScale"===d&&c.notifyObservers(press.play,d,e,{scale:p/r,center:{x:(g[0].x+g[1].x)/2,y:(g[0].y+g[1].y)/2}}),"touchRotate"===d&&c.notifyObservers(press.play,d,e,{rotate:n-a,center:{x:(g[0].x+g[1].x)/2,y:(g[0].y+g[1].y)/2}}))}}),c.on(document,"touchend",function(a){var n=a.target,r=a.touches,s=t;if(r){if(1===s){var o=b(v[0],g[0]);u>o&&(l.contains(L,n,!0)?e(a):"view_toPrev"===n.id?vt():"view_toNext"===n.id&&gt(),c.notifyObservers(press.play,"touchTap",a))}c.notifyObservers(press.play,"touchend",a)}})}else c.on(document,"keydown",function(e){if("EMBED"!==e.target.tagName)switch(e.keyCode){case 33:case 37:case 38:vt(),e.preventDefault();break;case 32:case 34:case 39:case 40:gt(),e.preventDefault();break;case 27:press.isPreview&&window.close();break;case 120:at();break;case 122:press.fsApi.isSupported&&(c.notifyObservers(press.fsApi,"toggle"),e.preventDefault())}}),c.on(l.id("view_toPrev"),"click",function(){vt()}),c.on(l.id("view_toNext"),"click",function(){gt()}),c.on(L,"click",e);c.on(window,"resize",function(){var e=l.getClientWidth(),t=l.getClientHeight();if(s!==e||o!==t){var a=s,n=o,r=i;s=e,o=t,q(),U.onresize(r),c.notifyObservers(press,"afterResize",{w:e,h:t},{w:a,h:n},i,r)}});var k=150,M=40,C=.26;c.addObserver(press,"afterResize",function(e){var t=e.w,a=e.h;if(U.hasLogo)if(300>=t&&300>=a)l.addClass(W,"none");else{l.removeClass(W,"none");var n=t/k,r=a/M,s=r>n?n:r,o=parseInt(C*s*k),i=parseInt(C*s*M);o=o>k?k:o,i=i>M?M:i,G.style.cssText+=";width:"+o+"px;height:"+i+"px;",$()}t>=a?(l.removeClass(D,"vertical"),l.removeClass(F,"vertical")):(l.addClass(D,"vertical"),l.addClass(F,"vertical"))}),U.bindEvents(),c.addObserver(press.play,"playModeChanged",function(e){if(e!==press.playMode){var t=location.search;-1!==t.indexOf("mode=")?location.search=t.replace(/mode=(\w+)/,"mode="+e):location.search+="&mode="+e}})},mt=function(e,t){B&&(B=null);var a,r,s;if("number"==typeof e?(e=0>e?0:e>=n.length?n.length-1:e,a=n[e],r=document.getElementById(a),s="frame"):"string"==typeof e&&(a=e,r=document.getElementById(a),s=r.getAttribute("eltype"),e=p.indexOf(n,"frame"===s?a:r.parentNode.id)),!a)return!1;if("frame"!==s&&(B=r),void 0!==T&&T!==e){var o=document.getElementById(n[T]);l.removeClass(o,"active")}T&&T===e||l.addClass(r,"active"),U.calTargetStyle(r,a,s,e),T=-1==e?T:e,U.gridAnimation(t),press.progress.move(T),c.notifyObservers(m,"frameChanged",T)},vt=function(e){if(T===n.length-1&&U.hasViewEndBox&&press.viewEndBox.isVisible())return void press.viewEndBox.hide();if(press.animate.ready){var t=press.loading.workdata.doc.step[T],a=this.$AnimateManager.getAnimationChain(t);if(a.prev())return void press.viewEndBox.hide()}var r=T-1;r>=0&&mt(r,e)},gt=function(e){var t;if(!press.animate.ready||(t=this.$AnimateManager.getAnimationChain(n[T]),!t.next(e))){var a=T+1;if(a==n.length){if(!e||!e.loop)return U.hasViewEndBox&&press.viewEndBox.show(),void(U.hasAutoPlay&&press.autoPlay.stop());a=0}if(press.animate.ready){t=this.$AnimateManager.getAnimationChain(n[a]),t.reset();var r=t.getByIndex(0);if(r)if(r.fire==press.animate.DEFAULT_SETTING_FIRE_PARALLEL)t.next(e);else if(r.fire==press.animate.DEFAULT_SETTING_FIRE_FOLLOW){e=e||{};var s=e.onComplete;e.onComplete=e.onComplete?function(){t.next(),s()}:function(){t.next()}}}mt(a,e)}},yt=function(e){var t=a.frame,n=h.source,r=n.frames,s=[],o={};for(var i in t)if(U.inView(i)){o[i]=t[i],l.id(i).style.display="block",r[i]&&s.push(i);for(var c=l.mini("svg",l.id(i)),p=0,d=c.length;d>p;p++)c[p].style.display="block"}else l.id(i).style.display="none";return!e&&s.length&&h.loadSource(s),o},bt=function(e,t){if("undefined"==typeof e.style.opacity)if(""===t){var a=e.style.cssText;a=a.replace(/filter[^;]*;*/gi,""),e.style.cssText=a}else e.style.filter="alpha(opacity="+100*t+")";else e.style.opacity=t},wt=function(){var e='使用 ← 和 → 键控制播放 <a id="closeHint" title="不再提醒" href="#">&times;</a>',t=l.id("hintText");t.innerHTML=e,l.removeClass(t,"none");for(var a=[],n=0;10>n;n++)a.push(.1*n);for(var n=0;10>n;n++)a.push(1-.1*n);for(var r=a.length,s=0,o=[l.id("view_toNext"),l.id("viewProgress")],i=v("transition"),n=o.length;n--;)i&&(o[n].style[i]="none");var p=+new Date+1e4,d=setInterval(function(){if(+new Date>p)u();else for(var e=o.length;e--;)bt(o[e],a[s++%r])},100),u=(o.concat([t]),function(){var e=!0;if(e){clearInterval(d);for(var a=o.length;a--;)bt(o[a],""),i&&(o[a].style[i]=null);l.addClass(t,"none"),c.off(document,"mouseover",u),c.off(document,"keydown",u)}});c.on(document,"keydown",u),c.on(l.id("closeHint"),"click",function(e){e.preventDefault(),f.set("nohint",1,"","",87600),t.style.display="none",u()})};e.extend(this,{moveTo:mt,checkModeSupport:ct,getMode:lt,getDisplayMode:pt,init:ut})}),Jx().$package("press.control",function(e){var t,a,n,r,s,o,i,l,c,p=e.dom,d=e.event,u=this,f=function(e){e?!u.alwaysFixed&&p.addClass(a,"fixed"):p.removeClass(a,"fixed")},h=function(){var e=p.id("view_bgSound");r=p.id("bgSound"),p.removeClass(e,"disabled"),e.title="背景音乐"},m=function(){var e=p.id("viewCenterBtns");d.on(e,"click",function(a){for(var n=a.target;"A"!==n.tagName&&n!==e;)n=n.parentNode;if(n!==e)if(p.hasClass(n,"btnFn"))switch(n.id){case"view_autoPlay":d.notifyObservers(t,"toggle");break;case"view_bgSound":r&&p.toggleClass(r,"show");break;case"view_fullScreen":i.isSupported&&d.notifyObservers(i,"toggle")}else p.hasClass(n,"btnMode")&&(a.preventDefault(),d.notifyObservers(press.play,"playModeChanged",n.id.slice(5)))}),d.addObserver(t,"startAutoPlay",function(){p.addClass(a,"autoPlay"),o.className=o.className.replace("iconPlay","iconPause"),s.title="暂停自动播放"}),d.addObserver(t,"stopAutoPlay",function(){p.removeClass(a,"autoPlay"),o.className=o.className.replace("iconPause","iconPlay"),s.title="自动播放"}),d.addObserver(i,"inFullscreen",function(){l.className=l.className.replace("icon-resize-full","icon-resize-small"),c.title="取消全屏"}),d.addObserver(i,"outFullscreen",function(){l.className=l.className.replace("icon-resize-small","icon-resize-full"),c.title="全屏"})},v=function(r){a=p.id("viewCenter"),n=p.id("autoPlayTime"),s=p.id("view_autoPlay"),o=p.mini(".iconPlay",s)[0];var d=e.platform,h=d.linux||d.win||d.mac;if(!h)return void p.addClass(a,"none");t=press.autoPlay,new e.ui.xInput(n,{rate:12,maskLayer:r,onDragStart:function(){f(!0)},onChange:function(e){t.setTime(e)},onBlur:function(){!u.alwaysFixed&&f(!1)}}),n.value=t.getTime(),c=p.id("view_fullScreen"),i=press.fsApi,i.isSupported?l=c:(p.addClass(c,"disabled"),c.title="当前浏览器不支持点击按钮全屏，请按F11");for(var v,g,y=p.mini("#playModeMenu .divider")[0],b=document.createDocumentFragment(),w=press.play.getDisplayMode(),x=0;g=w[x++];)v=p.node("li"),press.playMode===g.info.name&&p.addClass(v,"active"),v.innerHTML='<a class="btnMode" href="javascript:;" id="mode_'+g.info.name+'">'+g.info.label+"</a>",b.appendChild(v);y.parentNode.insertBefore(b,y),m(),p.removeClass(a,"none")};this.alwaysFixed=!1,e.extend(this,{init:v,enableBgSound:h,setFixed:f})}),Jx().$package("press.autoPlay",function(e){var t,a,n=e.event,r=this,s=3,o=1e3*s,i=function(){a({loop:!0,onComplete:function(){t&&(t=setTimeout(i,o))}})},l=function(e){o=1e3*(parseFloat(e)||0)},c=function(){return o/1e3},p=function(){t=setTimeout(i,o),n.notifyObservers(r,"startAutoPlay")},d=function(){t&&(clearTimeout(t),t=0,n.notifyObservers(r,"stopAutoPlay"))},u=function(e){a=e,n.addObserver(press.autoPlay,"toggle",function(){t?d():p()})};e.extend(this,{init:u,setTime:l,getTime:c,start:p,stop:d})}),Jx().$package("press.progress",function(e){var t,a,n,r=e.dom,s=e.event,o=this,i=r.id("viewProgress"),l=r.id("progressLoaded"),c=r.id("progressBlocks"),p=0,d=function(l,p){if(t=l,a=p,0===t)return i.style.display="none",context;n=100/t;for(var d="",u=0,f=1;t>=f;f++)d+=['<a class="progressBlock" title="跳转到第',f,'张" index="',f-1,'" href="javascript:;','" style="left:',u.toFixed(2),"%;width:",n.toFixed(2),'%;"></a>'].join(""),u+=n;c.innerHTML=d;var h=function(e){var t=e.target;r.hasClass(t,"progressBlock")&&(a(Number(t.getAttribute("index"))),e.preventDefault())};return e.platform.touchDevice?s.addObserver(press.play,"touchTap",h):s.on(c,"click",h),s.addObserver(press,"afterResize",function(e){e.w>e.h?r.removeClass(i,"vertical"):r.addClass(i,"vertical")}),o},u=function(e){return p=e,l.style.width=(e+1)*n+"%",o};e.extend(o,{init:d,move:u})}),Jx().$package("press.viewEndBox",function(e){var t=e.dom,a=e.event,n=this,r=t.id("afterView"),s=t.id("aboutBox"),o=function(){t.removeClass(r,"none")},i=function(){t.addClass(r,"none")},l=function(){return!t.hasClass(r,"none")},c=function(){a.on(r,"click",function(e){for(var a=e.target;"A"!==a.tagName&&a!==r;)a=a.parentNode;a!==r&&("view_toFirst"===a.id?(press.play.moveTo(0),press.play.$AnimateManager.resetAll(),e.preventDefault()):"btnAbout"===a.id?(s.style.display="block",e.preventDefault()):t.hasClass(a,"btnClose")&&i())}),a.on(t.id("aboutCloseBtn"),"click",function(e){s.style.display="none",e.preventDefault()}),a.addObserver(press.play,"frameChanged",i),a.addObserver(press,"afterResize",function(e){e.w<486?t.addClass(r,"mini"):t.removeClass(r,"mini")})};e.extend(n,{init:c,show:o,hide:i,isVisible:l})}),Jx().$package("press.contextmenu",function(e){var t,a,n,r=e.dom,s=e.event,o=[],i={wrapperMenu:{items:[{label:"作品详情",href:"http://www.ipresst.com/w/"+workdata.wid,target:"_blank"},{label:"作者主页",href:"http://www.ipresst.com/u/"+workdata.master,target:"_blank"},"-","-",{id:"m_auto_play",label:"自动播放",href:"#",onclick:function(e){s.notifyObservers(press.autoPlay,"toggle"),e.preventDefault()}},{id:"m_fullscreen",label:"全屏",href:"#",onclick:function(e){s.notifyObservers(press.fsApi,"toggle"),e.preventDefault()}}],check:function(e){var t,a=e.target;return r.contains(r.id("wrapper"),a,!0)&&(t=!0),t},onReady:function(){var e=r.id("m_fullscreen");press.fsApi.isSupported?(s.addObserver(press.fsApi,"inFullscreen",function(){e.innerHTML="退出全屏"}),s.addObserver(press.fsApi,"outFullscreen",function(){e.innerHTML="全屏"})):(e.title="该浏览器不支持按钮全屏，请使用F11",r.addClass(e.parentNode,"disabled"));var t=r.id("m_auto_play");s.addObserver(press.autoPlay,"startAutoPlay",function(){t.innerHTML="停止自动播放"}),s.addObserver(press.autoPlay,"stopAutoPlay",function(){t.innerHTML="自动播放"});for(var a,n=press.play.checkModeSupport,i=o.length;i--;)a=o[i].info.name,n(a)||r.addClass(r.id("m_mode_"+a).parentNode,"disabled")}}},l={},c=function(){p(),d()},p=function(){for(var e,t=i.wrapperMenu.items,a=0,n=t.length;n>a;a++)if("-"===t[a]){e=a+1;break}o=press.play.getDisplayMode();for(var a=o.length;a--;)!function(a){t.splice(e,0,{id:"m_mode_"+a.name,label:a.label,href:"#",onclick:function(e){s.notifyObservers(press.play,"playModeChanged",a.name),e.preventDefault()}})}(o[a].info)},d=function(){s.on(document,"contextmenu",function(e){var t,a;for(var n in i)if(t=i[n],t.check(e)){a=!0,f(e,n),e.preventDefault(),e.stopPropagation();break}a||h()})},u=function(e){for(var t=r.node("div",{id:e,"class":"dropdown-menu context-menu none"}),a=i[e],n=a.items,o="",c=0,p=n.length;p>c;c++)o+="-"===n[c]?'<li class="divider"></li>':["<li><a",n[c].id?' id="'+n[c].id+'"':"",n[c].href?' href="'+n[c].href+'"':"",n[c].target?' target="'+n[c].target+'"':"",">",n[c].label,"</a></li>"].join("");return t.innerHTML=o,document.body.appendChild(t),l[e]=t,s.on(t,"click",function(e){var t=e.target;if(r.hasClass(t.parentNode,"disabled"))return void e.stopPropagation();var a=t.id;if(a)for(var s=0,o=n.length;o>s;s++)if(a===n[s].id){n[s].onclick(e);break}}),a.onReady&&a.onReady(),t},f=function(e,a){var n=l[a];n||(n=u(a));var r,o,c=document.documentElement.clientWidth,p=document.documentElement.clientHeight,d=e.pageX,f=e.pageY;n.style.display="block",o=n.offsetHeight,r=n.offsetWidth,d+r>c&&(d-=r),f+o>p&&(f-=o),n.style.cssText+=";left:"+d+"px;top:"+f+"px;",t=a,i[a].onShow&&i[a].onShow(e),s.on(document,"click",h)},h=function(){if(t){var e=l[t];e.style.display="none",s.off(document,"click",h),a=null,n="",t=""}};e.extend(this,{init:c})}),Jx().$package("press.main",function(e){var t=(e.dom,e.event),a=function(){if(!location.href.match(/mode/)){var e=press.loading.workdata.doc.setting.playMode;press.playMode=e,"mobile"===press.loading.workdata.doc.setting.playMode&&(location.search+="&mode=mobile")}press.play.init(),press.contextmenu.init(),t.notifyObservers(press,"ready")};null!=press.loading.workdata&&(a(),press.loading.updateProgress(1)),e.extend(this,{init:a}),press.loading.setAllLoaded(!0)});